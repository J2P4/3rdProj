<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J2P4 MES</title>
    <!-- 깨끗하고 현대적인 느낌을 주는 Inter 폰트 사용 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for data visualization: 메인 대시보드에 차트를 표시하기 위해 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* 차트 캔버스의 최대 높이 설정 (반응형 대응) */
        #productionChart {
            max-height: 400px; /* 차트의 최대 높이 지정 */
            width: 100% !important;
            height: auto !important;
        }
        
        /* Tailwind 안써볼라 했다.... (사용자 CSS 유지) */
        :root {
            --header-bg: rgb(24, 33, 49);
            --nav-bg: rgb(17, 24, 39);
        }

        /* 호버 및 활성화 스타일 */
        .mainList li {
            position: relative;
            transition-property: background-color, border-left-color;
            transition-duration: 200ms;
        }
        .mainList li:hover {
            background-color: rgb(24, 33, 49);
        }
        
        /* 활성화된 부모 메뉴 스타일 */
        .active-parent {
            background-color: rgb(24, 33, 49);
            border-left: 4px solid #3b82f6;
            padding-left: 12px;
        }

        /* 활성화된 메뉴 아이템 스타일 */
        .active-link {
            background-color: rgb(24, 33, 49);
            border-left: 4px solid #3b82f6;
            padding-left: 12px;
        }

        .header-bg {
            background-color: var(--header-bg);
        }

        .nav-bg {
            background-color: var(--nav-bg);
        }

        /* 서브 메뉴 애니메이션 효과 */
        .subList {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out;
        }
    
        /* 변경: 높이는 JS에서 동적으로 설정, 여기서는 투명도만 처리 */
        .subList.visible {
            opacity: 1;
        }
        
        .drop {
            text-align:center; 
            font-weight: bold; 
            min-height: 100px; /* height 대신 min-height 사용 */
            font-size: 20px;
            padding: 8px;
        }
        .row {
            margin: 10px;
        }

        /* 게시판 테이블 스타일 */
        .board-table th, .board-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .board-table th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #1f2937;
        }
        .post-link {
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .post-link:hover {
            background-color: #f3f4f6;
        }
        /* 유형 배지 스타일 (Tailwind로 최대한 구현) */
        .badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 5px; /* full rounded */
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">
    <!-- 상단 헤더 섹션 (가로 정렬) -->
    <header class="header-bg text-white p-4 shadow-lg flex justify-between items-center z-50 relative">
        <div class="flex items-center space-x-2">
        <a href="#main">
            <!-- 사용자 이미지 URL 대체 -->
            <img src="https://placehold.co/40x40/3b82f6/ffffff?text=J2P4" class="w-10 rounded-full" alt="회사 로고">
        </a>
        <a href="#main">
            <h3 class="text-xl font-bold">J2P4 MES</h3>
        </a>
        </div>
        <div class="flex items-center space-x-4 sm:space-x-8">
            <div class="search cursor-pointer p-1 rounded-full hover:bg-gray-700 transition-colors">
                <!-- 검색 아이콘 대체 (Lucide Icons 스타일) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </div>
            <div class="logout text-sm sm:text-base cursor-pointer hover:underline">
                <form method="post" action="/proj_mes/logout">
                    <button type="submit">로그아웃</button>
                </form>
            </div>

            <!-- 사람 아이콘 + 드롭다운 -->
            <div class="myIcon relative">
                <button id="myIconBtn" class="focus:outline-none" aria-haspopup="true" aria-expanded="false">
                    <!-- 사람 아이콘 대체 (Lucide Icons 스타일) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#1f2937" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 rounded-full bg-white p-1"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                </button>

                <!-- 드롭다운 메뉴 -->
                <div id="userMenu"
                    class="absolute right-0 mt-2 w-40 bg-white text-gray-800 rounded-lg shadow-xl border hidden z-50 drop" >
                    <div class="row">
                        <a href="/proj_mes/AccountManage" class="block py-2 px-4 hover:bg-gray-100 rounded-md">계정관리</a>
                    </div>
                    <!-- 이슈 처리 -->
                    <div class="row">
                        <a href="/proj_mes/IssueCtrl" class="block py-2 px-4 hover:bg-gray-100 rounded-md">이슈처리</a>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <!-- 메인 레이아웃: 사이드바 + 콘텐츠 -->
    <div class="flex flex-1">
        <!-- 좌측 사이드바 (세로 정렬) -->
        <aside class="nav-bg text-white p-4 w-56 shadow-inner flex-shrink-0">
            <ul class="mainList space-y-2 text-base">
                <!-- 메인 메뉴 추가 (data-page 추가) -->
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200" data-page="main">메인</li>
                
                <!-- 발주 관리 -->
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200" data-page="order_manage">발주 관리</li>
                
                <!-- 기준 관리 메뉴와 하위 메뉴 -->
                <li class="parent-menu relative p-3 rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between">
                        <span>기준 관리</span>
                        <!-- 화살표 아이콘 -->
                        <svg class="w-4 h-4 transition-transform duration-200 parent-arrow" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2 pl-5">
                        <!-- data-page 추가 -->
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="stock_manage">재고 관리</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="client_manage">거래처 관리</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="item_manage">품목 관리</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="bom_manage">BOM 관리</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="process_manage">공정 관리</li>
                    </ul>
                </li>

                <!-- 생산 관리 메뉴와 하위 메뉴 -->
                <li class="parent-menu relative p-3 rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between">
                        <span>생산 관리</span>
                        <svg class="w-4 h-4 transition-transform duration-200 parent-arrow" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2 pl-4">
                        <!-- data-page 추가 -->
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="production_plan">생산 계획</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="work_order">작업 지시서</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="production_record">생산 실적</li>
                    </ul>
                </li>

                <!-- 품질 관리 메뉴와 하위 메뉴 -->
                <li class="parent-menu relative p-3 rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between">
                        <span>품질 관리</span>
                        <svg class="w-4 h-4 transition-transform duration-200 parent-arrow" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2 pl-4">
                        <!-- data-page 추가 -->
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="qc_inbound">입고 검사</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="qc_process">공정 검사</li>
                        <li class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200" data-page="qc_defect">불량 보고서</li>
                    </ul>
                </li>
                
                <!-- 게시판 (data-page 추가) -->
                <li class="relative p-3 rounded-md cursor-pointer transition-colors duration-200" data-page="board">게시판</li>
            </ul>
        </aside>

        <!-- 메인 콘텐츠 영역 -->
        <main id="mainContent" class="main-content flex-1 p-8 overflow-y-auto">
            <!-- JS에 의해 동적으로 내용이 로드됨 -->
            <div class="bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-3xl font-bold text-gray-700 mb-4">메인</h2>
            </div>
        </main>
    </div>

    <script>
        // 현재 페이지의 콘텐츠를 담는 객체
        const pageContents = {
            'main': `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">실시간 대시보드 요약</h2>

                <!-- 핵심 성과 지표 (KPI) 카드 섹션 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- KPI Card 1: 총 생산량 -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500 hover:shadow-xl transition-shadow cursor-default">
                        <p class="text-sm font-semibold text-gray-500">총 생산량 (금일)</p>
                        <p class="text-4xl font-bold text-gray-900 mt-1">4,582 <span class="text-lg font-normal text-blue-500">EA</span></p>
                        <p class="text-xs text-green-500 mt-2">▲ 3.5% (어제 대비)</p>
                    </div>
                    <!-- KPI Card 2: 불량률 -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500 hover:shadow-xl transition-shadow cursor-default">
                        <p class="text-sm font-semibold text-gray-500">불량률 (평균)</p>
                        <p class="text-4xl font-bold text-gray-900 mt-1">1.2<span class="text-lg font-normal text-red-500">%</span></p>
                        <p class="text-xs text-red-500 mt-2">▼ 0.1% (주간 평균)</p>
                    </div>
                    <!-- KPI Card 3: 재고 수준 -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500 hover:shadow-xl transition-shadow cursor-default">
                        <p class="text-sm font-semibold text-gray-500">재고 경고 건</p>
                        <p class="text-4xl font-bold text-gray-900 mt-1">7 <span class="text-lg font-normal text-yellow-500">건</span></p>
                        <p class="text-xs text-gray-500 mt-2">긴급 재고 부족 라인</p>
                    </div>
                    <!-- KPI Card 4: 가동률 -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500 hover:shadow-xl transition-shadow cursor-default">
                        <p class="text-sm font-semibold text-gray-500">라인 가동률</p>
                        <p class="text-4xl font-bold text-gray-900 mt-1">92.8<span class="text-lg font-normal text-green-500">%</span></p>
                        <p class="text-xs text-green-500 mt-2">목표 달성 (90%)</p>
                    </div>
                </div>
                
                <!-- 차트 섹션 (Chart.js 렌더링을 위한 캔버스) -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">주간 생산 라인별 실적 비교</h3>
                    <div class="relative h-96"> <!-- 차트 컨테이너 높이 설정 -->
                        <canvas id="productionChart"></canvas>
                    </div>
                </div>
            `,
            'order_manage': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">발주 관리</h2><p class="text-gray-600">발주 목록을 조회하고 신규 발주를 등록하는 화면입니다.</p></div>',
            'stock_manage': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">재고 관리</h2><p class="text-gray-600">현재 품목별 재고 현황을 확인하고 조정할 수 있습니다.</p></div>',
            'client_manage': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">거래처 관리</h2><p class="text-gray-600">등록된 모든 거래처 정보를 관리합니다.</p></div>',
            'item_manage': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">품목 관리</h2><p class="text-gray-600">생산 품목의 규격, 단위 등의 기본 정보를 관리합니다.</p></div>',
            'bom_manage': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">BOM 관리</h2><p class="text-gray-600">제품의 자재 명세서(Bill of Materials)를 관리합니다.</p></div>',
            'process_manage': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">공정 관리</h2><p class="text-gray-600">생산에 필요한 공정 정보를 설정하고 관리합니다.</p></div>',
            'production_plan': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">생산 계획</h2><p class="text-gray-600">주간/월간 생산 계획을 수립하고 관리합니다.</p></div>',
            'work_order': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">작업 지시서</h2><p class="text-gray-600">생산 라인에 배포할 작업 지시서를 생성합니다.</p></div>',
            'production_record': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">생산 실적</h2><p class="text-gray-600">공정별 생산 실적을 등록 및 조회합니다.</p></div>',
            'qc_inbound': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">입고 검사</h2><p class="text-gray-600">입고 자재에 대한 품질 검사 기록을 관리합니다.</p></div>',
            'qc_process': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">공정 검사</h2><p class="text-gray-600">생산 공정 중 발생하는 중간 검사 기록을 관리합니다.</p></div>',
            'qc_defect': '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-gray-700 mb-4">불량 보고서</h2><p class="text-gray-600">발생한 불량 건에 대한 상세 보고서를 작성하고 조회합니다.</p></div>',
            
            // 게시판 목록 화면 (업데이트)
            'board': `
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-3xl font-bold text-gray-700 mb-6">게시판</h2>

                    <!-- 검색 및 글쓰기 섹션 (이미지 레이아웃 반영) -->
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
                        <!-- 검색 필터 -->
                        <div class="flex items-center space-x-2 w-full sm:w-auto flex-wrap gap-2 sm:gap-0">
                            <select class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option>검색 조건</option>
                                <option>제목</option>
                                <option>작성자 ID</option>
                            </select>
                            <select class="p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option>유형</option>
                                <option>공유</option>
                                <option>긴급</option>
                                <option>안내</option>
                                <option>자유</option>
                            </select>
                            <div class="relative flex-grow">
                                <input type="text" placeholder="검색 내용을 입력하세요." class="w-full p-2 pr-10 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <button class="absolute right-0 top-0 h-full px-3 text-gray-500 hover:text-blue-600 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- 글쓰기 버튼 -->
                        <button class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition-colors ml-0 sm:ml-4">
                            글쓰기
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse board-table">
                            <thead>
                                <tr class="bg-gray-50 border-b">
                                    <th class="w-16 rounded-tl-lg">순번</th>
                                    <th class="w-24">유형</th>
                                    <th class="w-auto">제목</th>
                                    <th class="w-32 rounded-tr-lg">작성자 ID</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 게시글 항목 (총 15개) -->
                                <tr class="post-link" data-post-id="101">
                                    <td>1</td>
                                    <td><span class="badge bg-green-100 text-green-700">공유</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 재고 관리 최적화: FIFO 원칙 적용 성공 사례 공유</td>
                                    <td>N24101412</td>
                                </tr>
                                <tr class="post-link" data-post-id="102">
                                    <td>2</td>
                                    <td><span class="badge bg-blue-100 text-blue-700">안내</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> [필독] 11월 MES 시스템 정기 업데이트 및 서버 점검 일정 공지</td>
                                    <td>N24100103</td>
                                </tr>
                                <tr class="post-link" data-post-id="103">
                                    <td>3</td>
                                    <td><span class="badge bg-red-100 text-red-700">긴급</span></td>
                                    <td class="font-medium text-red-600 hover:text-red-700 hover:underline"> 🚨긴급🚨 라인 5 품질 센서 오작동, 수동 검사 전환 필요!</td>
                                    <td>N24092598</td>
                                </tr>
                                <tr class="post-link" data-post-id="104">
                                    <td>4</td>
                                    <td><span class="badge bg-gray-200 text-gray-700">자유</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 생산성 향상에 도움된 도서 '린 제조의 정석' 후기</td>
                                    <td>N24100345</td>
                                </tr>
                                <tr class="post-link" data-post-id="105">
                                    <td>5</td>
                                    <td><span class="badge bg-blue-100 text-blue-700">안내</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 신규 입고 도서의 품목 등록 기준 및 규격 안내</td>
                                    <td>N24101267</td>
                                </tr>
                                <tr class="post-link" data-post-id="106">
                                    <td>6</td>
                                    <td><span class="badge bg-blue-100 text-blue-700">안내</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 4분기 공정별 안전 교육 의무 이수 대상자 명단 공지</td>
                                    <td>N24090120</td>
                                </tr>
                                <tr class="post-link" data-post-id="107">
                                    <td>7</td>
                                    <td><span class="badge bg-gray-200 text-gray-700">자유</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 서점 물류센터 자동화 로봇 이용 공모합니다!</td>
                                    <td>N24100574</td>
                                </tr>
                                <tr class="post-link" data-post-id="108">
                                    <td>8</td>
                                    <td><span class="badge bg-green-100 text-green-700">공유</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 품질 불량률 10% 감소 달성! 공정 개선 아이디어 제안</td>
                                    <td>N24091531</td>
                                </tr>
                                <tr class="post-link" data-post-id="109">
                                    <td>9</td>
                                    <td><span class="badge bg-gray-200 text-gray-700">자유</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 현장 작업 시 필요한 개인 보호 장비 개선 건의</td>
                                    <td>N24100856</td>
                                </tr>
                                <tr class="post-link" data-post-id="110">
                                    <td>10</td>
                                    <td><span class="badge bg-gray-200 text-gray-700">자유</span></td>
                                    <td class="font-medium text-gray-800 hover:text-blue-600 hover:underline"> 이번 주 가장 힘들었던 공정은 무엇이었는지 자유롭게 이야기 해보세요.</td>
                                    <td>N24100910</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 페이지네이션 (이미지 레이아웃 반영) -->
                    <div class="flex justify-center mt-6">
                        <nav class="flex items-center space-x-1" aria-label="Pagination">
                            <a href="#" class="p-2 text-sm text-gray-500 hover:bg-gray-200 rounded-lg">이전</a>
                            <a href="#" class="p-2 text-sm font-semibold bg-blue-500 text-white rounded-lg shadow-md">1</a>
                            <a href="#" class="p-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg">2</a>
                            <a href="#" class="p-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg">3</a>
                            <a href="#" class="p-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg">4</a>
                            <a href="#" class="p-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg">5</a>
                            <a href="#" class="p-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg">6</a>
                            <a href="#" class="p-2 text-sm text-gray-700 hover:bg-gray-200 rounded-lg">7</a>
                            <a href="#" class="p-2 text-sm text-gray-500 hover:bg-gray-200 rounded-lg">다음</a>
                        </nav>
                    </div>
                </div>
            `,

            // 게시글 상세 화면 (업데이트: 새로운 게시글 내용에 맞게 수정)
            'post_detail': (postId) => {
                // postId에 따른 동적 콘텐츠 설정
                let title = `게시글 제목 (${postId})`;
                let type = '일반';
                let writerId = `N24...${(100 + parseInt(postId)).toString().substring(3)}`;

                if (postId === '101') {
                    title = '재고 관리 최적화: FIFO 원칙 적용 성공 사례 공유';
                    type = '공유';
                    writerId = 'N2410141287';
                } else if (postId === '102') {
                    title = '[필독] 11월 MES 시스템 정기 업데이트 및 서버 점검 일정 공지';
                    type = '안내';
                    writerId = 'N2410010359';
                } else if (postId === '103') {
                    title = '🚨긴급🚨 라인 5 품질 센서 오작동, 수동 검사 전환 필요!';
                    type = '긴급';
                    writerId = 'N2409259811';
                }
                
                return `
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-4xl font-extrabold text-gray-800 mb-4">${title}</h2>
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center text-sm text-gray-500 border-b pb-2 mb-4">
                        <span>유형: <span class="font-bold text-base text-gray-700">${type}</span></span>
                        <span>작성자 ID: ${writerId} | 작성일: 2025.10.${15 - (postId % 100)}</span>
                    </div>
                    <div class="text-gray-700 leading-relaxed min-h-48 border p-4 rounded-md bg-gray-50">
                        <p class="mb-4 font-semibold">${title}의 상세 내용입니다.</p>
                        <hr class="my-3">
                        <p>MES 시스템 개선에 대한 여러분의 관심과 협조에 감사드립니다. 더 나은 생산 환경을 위해 지속적으로 노력하겠습니다.</p>
                        <p class="mt-3">궁금한 점이나 추가 문의 사항이 있다면 댓글이나 작성자에게 직접 문의해 주세요. (게시글 번호: ${postId})</p>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button onclick="window.location.hash='board';" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition-colors">
                            목록으로 돌아가기
                        </button>
                        <button class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition-colors">
                            삭제
                        </button>
                    </div>
                </div>
            `;
            },
        };

        // 전역 변수로 차트 인스턴스를 저장하여 메모리 누수를 방지
        let productionChartInstance = null; 

        // Chart 렌더링 함수
        function renderChart() {
            const ctx = document.getElementById('productionChart');
            
            // 기존 차트 인스턴스가 있으면 파괴
            if (productionChartInstance) {
                productionChartInstance.destroy();
            }

            if (ctx) {
                productionChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['라인 1 (A)', '라인 2 (B)', '라인 3 (C)', '라인 4 (D)'],
                        datasets: [{
                            label: '금일 목표 대비 달성률 (%)',
                            data: [95, 88, 105, 99],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)', // Blue
                                'rgba(249, 115, 22, 0.7)', // Orange
                                'rgba(34, 197, 94, 0.7)',  // Green
                                'rgba(139, 92, 246, 0.7)'  // Purple
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(249, 115, 22, 1)',
                                'rgba(34, 197, 94, 1)',
                                'rgba(139, 92, 246, 1)'
                            ],
                            borderWidth: 1,
                            borderRadius: 6,
                        }]
                    },
                    options: {
                        responsive: true,
                        // 부모 요소에 h-96 클래스가 있으므로 false로 설정
                        maintainAspectRatio: false, 
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += context.raw + '%';
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 120,
                                title: {
                                    display: true,
                                    text: '달성률 (%)'
                                }
                            }
                        }
                    }
                });
            }
        }

        /* 사이드바 및 페이지 이동 로직 */
        document.addEventListener('DOMContentLoaded', () => {
            const mainContent = document.getElementById('mainContent');
            const menuItems = document.querySelectorAll('.mainList > li:not(.parent-menu)');
            const parentMenus = document.querySelectorAll('.parent-menu');
            const allItems = [...menuItems, ...document.querySelectorAll('.subList li')];

            // 모든 메뉴의 활성화 상태를 초기화
            function deactivateAll() {
                allItems.forEach(item => {
                    item.classList.remove('active-link');
                    item.classList.add('transition-colors', 'duration-200');
                });
                parentMenus.forEach(menu => {
                    menu.classList.remove('active-parent');
                    const subList = menu.querySelector('.subList');
                    const arrow = menu.querySelector('.parent-arrow');
                    
                    // 현재 활성화된(열린) 상태가 아니면 닫기
                    if (!subList.classList.contains('active-open')) {
                         // 강제로 닫기
                        subList.classList.remove('visible');
                        subList.style.maxHeight = '0px';
                        if(arrow) arrow.style.transform = 'rotate(0deg)';
                    }
                });
            }

            // 페이지를 로드하고 URL 해시를 업데이트하는 핵심 함수
            function loadPage(pageKey, postId = null) {
                deactivateAll(); // 모든 활성화 상태 초기화

                // 1. 콘텐츠 로드
                let contentHtml = '';
                let newHash = pageKey;

                if (pageKey.startsWith('post_detail')) {
                    // 게시글 상세 페이지인 경우, postId로 콘텐츠 생성
                    const keyParts = pageKey.split('?id=');
                    const id = keyParts.length > 1 ? keyParts[1] : postId; 
                    if (id && typeof pageContents['post_detail'] === 'function') {
                        contentHtml = pageContents['post_detail'](id);
                        newHash = `post_detail?id=${id}`;
                    } else {
                        contentHtml = '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-red-600 mb-4">404 Post Not Found</h2><p class="text-gray-600">요청하신 게시글을 찾을 수 없습니다.</p></div>';
                    }
                } else if (pageContents[pageKey]) {
                    // 일반 메뉴 페이지 로드
                    contentHtml = pageContents[pageKey];
                } else {
                    // 정의되지 않은 페이지
                    contentHtml = '<div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-3xl font-bold text-red-600 mb-4">404 Page Not Found</h2><p class="text-gray-600">요청하신 페이지를 찾을 수 없습니다.</p></div>';
                }
                mainContent.innerHTML = contentHtml;
                
                // 2. URL 해시 업데이트
                if (window.location.hash !== `#${newHash}`) {
                    window.location.hash = newHash;
                }

                // 3. 현재 메뉴 활성화 상태 설정 (UI 업데이트)
                let activeLinkElement = document.querySelector(`[data-page="${pageKey.split('?')[0]}"]`);
                
                // 게시글 상세의 경우 'board' 메뉴 활성화
                if (pageKey.startsWith('post_detail')) {
                    activeLinkElement = document.querySelector('[data-page="board"]');
                }

                if (activeLinkElement) {
                    activeLinkElement.classList.add('active-link');
                    
                    // 부모 메뉴 찾아서 활성화 (서브 메뉴인 경우)
                    const parentMenu = activeLinkElement.closest('.parent-menu');
                    if (parentMenu) {
                        parentMenu.classList.add('active-parent');
                        const subList = parentMenu.querySelector('.subList');
                        const arrow = parentMenu.querySelector('.parent-arrow');
                        
                        // 서브 메뉴 펼치기
                        subList.classList.add('visible', 'active-open'); 
                        subList.style.maxHeight = subList.scrollHeight + 'px';
                        if(arrow) arrow.style.transform = 'rotate(90deg)';
                    }
                }
                
                // 4. 차트 렌더링 (메인 페이지에만 해당)
                if (pageKey === 'main') {
                    // DOM 업데이트 후 다음 틱에서 차트 렌더링
                    setTimeout(renderChart, 50); 
                }

                // 5. 게시판 목록 로드 후 이벤트 리스너 재부착 (게시글 제목 클릭 이벤트)
                if (pageKey === 'board') {
                    attachPostClickHandlers();
                }
            }
            
            // 게시글 제목 클릭 이벤트 핸들러 (동적 콘텐츠에 바인딩)
            function attachPostClickHandlers() {
                document.querySelectorAll('.post-link').forEach(row => {
                    // 이미 리스너가 있는 경우 건너뛰기
                    if (row.getAttribute('data-has-listener')) return;

                    row.addEventListener('click', () => {
                        const postId = row.getAttribute('data-post-id');
                        // 상세 페이지로 이동
                        loadPage(`post_detail?id=${postId}`, postId);
                    });
                    row.setAttribute('data-has-listener', 'true');
                });
            }


            /* --- 사이드바 메뉴 클릭 이벤트 처리 --- */

            // 부모 메뉴 클릭/토글 (기존 로직 유지)
            parentMenus.forEach(parentMenu => {
                const subList = parentMenu.querySelector('.subList');
                const arrow = parentMenu.querySelector('.parent-arrow');
                
                parentMenu.addEventListener('click', () => {
                    const isParentActive = subList.classList.contains('visible');

                    // 모든 부모 메뉴 닫기 (토글되는 메뉴 제외)
                    parentMenus.forEach(p => {
                        if (p !== parentMenu) {
                            p.querySelector('.subList').style.maxHeight = '0px';
                            p.querySelector('.subList').classList.remove('visible', 'active-open');
                            p.classList.remove('active-parent');
                            if(p.querySelector('.parent-arrow')) p.querySelector('.parent-arrow').style.transform = 'rotate(0deg)';
                        }
                    });

                    if (isParentActive) {
                        subList.classList.remove('visible', 'active-open');
                        subList.style.maxHeight = '0px';
                        parentMenu.classList.remove('active-parent');
                        if(arrow) arrow.style.transform = 'rotate(0deg)';
                    } else {
                        // 다른 일반 메뉴 비활성화
                        deactivateAll(); 
                        
                        subList.classList.add('visible', 'active-open');
                        parentMenu.classList.add('active-parent');
                        subList.style.maxHeight = subList.scrollHeight + 'px';
                        if(arrow) arrow.style.transform = 'rotate(90deg)';
                    }
                });
            });


            // 모든 메뉴 항목(일반 메뉴, 서브 메뉴) 클릭 시 페이지 로드
            allItems.forEach(item => {
                item.addEventListener('click', (event) => {
                    // 부모 메뉴 클릭 이벤트 중복 방지 (서브 메뉴를 클릭하면 부모 메뉴 이벤트는 전파되지 않도록)
                    if (item.closest('.subList')) {
                        event.stopPropagation();
                    } else if (item.classList.contains('parent-menu')) {
                        // 부모 메뉴 자체 클릭 시 (드롭다운 토글만)
                        return;
                    }

                    const pageKey = item.getAttribute('data-page');
                    if (pageKey) {
                        loadPage(pageKey);
                    }
                });
            });

            /* --- URL 해시 변경 감지 (뒤로 가기/앞으로 가기 지원) --- */
            function handleHashChange() {
                const hash = window.location.hash.substring(1); // # 제거
                // 해시가 없으면 'main' 페이지로, 아니면 해당 해시로 페이지 로드
                loadPage(hash || 'main');
            }

            // 최초 로드 시 페이지 결정
            handleHashChange();
            
            // 해시 변경 이벤트에 리스너 등록
            window.addEventListener('hashchange', handleHashChange);


            /* 창 크기 변경 시 열린 메뉴 높이 재계산 */
            window.addEventListener('resize', () => {
                document.querySelectorAll('.subList.visible').forEach(el => {
                    // height가 0이 아닌 열린 메뉴만 재계산
                    if (el.style.maxHeight !== '0px') {
                        el.style.maxHeight = el.scrollHeight + 'px';
                    }
                });
            });
        });

        /* === 우측 상단 사용자 드롭다운 === */
        const myIconBtn = document.getElementById('myIconBtn');
        const userMenu  = document.getElementById('userMenu');

        function closeUserMenu() {
            userMenu.classList.add('hidden');
            myIconBtn.setAttribute('aria-expanded', 'false');
        }

        myIconBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userMenu.classList.toggle('hidden');
            myIconBtn.setAttribute('aria-expanded',
                userMenu.classList.contains('hidden') ? 'false' : 'true');
        });

        userMenu.addEventListener('click', (e) => e.stopPropagation());
        document.addEventListener('click', closeUserMenu);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeUserMenu();
        });
    </script>

</body>
</html>
