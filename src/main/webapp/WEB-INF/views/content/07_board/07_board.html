<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J2P4 MES System - 게시판</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="07_board.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tinymce@5/tinymce.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tinymce@5/langs/ko.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

    <header class="header-bg text-white p-4 shadow-lg flex justify-between items-center z-50 relative">
        <div class="flex items-center space-x-2">
        <a href = "/proj_mes/mainpage">
            <img src="https://i.postimg.cc/qMsq73hD/icon.png" class="w-10" alt="회사 로고">
        </a>
        <a href = "/proj_mes/mainpage">
            <h3 class="text-xl font-bold">J2P4</h3>
        </a>
        </div>
        <div class="flex items-center space-x-4 sm:space-x-8">
            <div class="search cursor-pointer">
                <img src="https://i.postimg.cc/9QcMwQym/magnifier-white.png" class="w-6 sm:w-7" alt="검색용 아이콘">
            </div>
            <div class="logout text-sm sm:text-base cursor-pointer hover:underline">
                <form method="post" action="/proj_mes/logout">
                    <button type="submit">로그아웃</button>
                </form>
            </div>

            <div class="myIcon relative">
                <button id="myIconBtn" class="focus:outline-none" aria-haspopup="true" aria-expanded="false">
                    <img src="https://i.postimg.cc/zfVqTbvr/user.png" class="w-8 sm:w-9 rounded-full bg-white" alt="마이페이지 아이콘">
                </button>

                <div id="userMenu"
                    class="absolute right-0 mt-2 w-40 bg-white text-gray-800 rounded-lg shadow-lg border hidden z-50 drop" >
                    <div class="row">
                        <a href="${pageContext.request.contextPath}/workerlist">계정관리</a><br>
                    </div>
                    <div class="row">
                        <a href="${pageContext.request.contextPath}/pw_change">비밀번호 변경</a><br>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1">
        <aside class="nav-bg text-white p-4 w-56 shadow-inner flex-shrink-0">
            <ul class="mainList space-y-2 text-base">
                <!-- relative : 요소의 position 속성을 relative로 설정 -->
                <li data-page="main" class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">메인</li>
                
                <li data-page="order" class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">발주 관리</li>
                
                <li data-page="standard-parent" class="parent-menu relative p-3 rounded-md cursor-pointer transition-colors duration-200"> <!-- duration : 트랜지션 지속시간 200ms -->
                    <div class="flex items-center justify-between">
                        <span>기준 관리</span>
                        <!-- svg : 화살표 전체 아이콘 | 속도 : duration | viewBox : svg의 좌표 공간(0~20) 설정 | path : 실제 화살표의 모양 경로 -->
                        <svg class="w-4 h-4 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
                            <!-- evenodd : 짝수 홀수 규칙 적용 , 한 점에서 경로를 가로지르는 횟수가 홀수면 채우고, 짝수면 비워둠 , 겹치는 부분을 비워주는 규칙-->
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2 pl-5">
                        <li data-page="standard-stock" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">재고 관리</li>
                        <li data-page="standard-partner" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">거래처 관리</li>
                        <li data-page="standard-item" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">품목 관리</li>
                        <li data-page="standard-bom" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">BOM 관리</li>
                        <li data-page="standard-process" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">공정 관리</li>
                    </ul>
                </li>

                <li data-page="production-parent" class="parent-menu relative p-3 rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between">
                        <span>생산 관리</span>
                        <svg class="w-4 h-4 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2 pl-4">
                        <li data-page="production-plan" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">생산 계획</li>
                        <li data-page="production-order" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">작업 지시서</li>
                        <li data-page="production-actual" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">생산 실적</li>
                    </ul>
                </li>

                <li data-page="quality-parent" class="parent-menu relative p-3 rounded-md cursor-pointer transition-colors duration-200">
                    <div class="flex items-center justify-between">
                        <span>품질 관리</span>
                        <svg class="w-4 h-4 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <ul class="subList space-y-1 mt-2 pl-4">
                        <li data-page="quality-inbound" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">입고 검사</li>
                        <li data-page="quality-process" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">공정 검사</li>
                        <li data-page="quality-defect" class="py-2 px-3 rounded-md cursor-pointer transition-colors duration-200">불량 보고서</li>
                    </ul>
                </li>
                
                <li data-page="board" class="relative p-3 rounded-md cursor-pointer transition-colors duration-200">게시판</li>
            </ul>
        </aside>

        <main class="main-content flex-1 p-8 overflow-y-auto">
            
        </main>
    </div>

    <script>
                <div class = "slide-btnbox">
    <c:if test="${sessionScope.role != 'STAFF'}">
                    <a href="modify?worker_id=${dto.worker_id}" class="slide-btn modify-btn">수정</a>
                <a href="workerlist" class="slide-btn close-btn">취소</a>
        </c:if>
        <c:if test="${sessionScope.role == 'STAFF'}">
                <a href="workerlist" class="slide-btn close-btn">취소</a>
        </c:if>
 </div>
    </script>
    <script>
        /* 사이드바 하위 목록에 따라 늘어나게*/
        document.addEventListener('DOMContentLoaded', () => {
            const menuItems = document.querySelectorAll('.mainList > li:not(.parent-menu)');
            const parentMenus = document.querySelectorAll('.parent-menu');
            const allItems = [...menuItems, ...document.querySelectorAll('.subList li')];
            const mainContent = document.querySelector('.main-content'); 

            // 페이지별 내용을 렌더링하는 더미 함수 (게시판은 07_board.js에서 처리)
            const pageRenderers = {
                'main': () => `
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">메인 페이지</h2>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <p class="text-lg font-medium text-gray-500">
                            메인 페이지 내용입니다.
                        </p>
                    </div>
                `,
                'board': () => loadBoardContent('list'), // 게시판 호출
                // 다른 메뉴들은 간단한 플레이스홀더
                'order': () => renderPlaceholder('발주 관리'),
                'standard-stock': () => renderPlaceholder('기준 관리 - 재고'),
                'standard-partner': () => renderPlaceholder('기준 관리 - 거래처'),
                'standard-item': () => renderPlaceholder('기준 관리 - 품목'),
                'standard-bom': () => renderPlaceholder('기준 관리 - BOM'),
                'standard-process': () => renderPlaceholder('기준 관리 - 공정'),
                'production-plan': () => renderPlaceholder('생산 관리 - 생산 계획'),
                'production-order': () => renderPlaceholder('생산 관리 - 작업 지시서'),
                'production-actual': () => renderPlaceholder('생산 관리 - 생산 실적'),
                'quality-inbound': () => renderPlaceholder('품질 관리 - 입고 검사'),
                'quality-process': () => renderPlaceholder('품질 관리 - 공정 검사'),
                'quality-defect': () => renderPlaceholder('품질 관리 - 불량 보고서'),
            };

            function renderPlaceholder(title) {
                return `
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">${title}</h2>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <p class="text-lg font-medium text-gray-500">
                            이 페이지는 현재 개발 중이거나 데이터가 없습니다.
                        </p>
                    </div>
                `;
            }

            // 모든 메뉴의 활성화 상태를 초기화
            function deactivateAll() {
                allItems.forEach(item => {
                    item.classList.remove('active-link');
                    item.classList.add('transition-colors', 'duration-200');
                });
                parentMenus.forEach(menu => {
                    const subList = menu.querySelector('.subList');
                    const arrow = menu.querySelector('svg');
                    subList.classList.remove('visible');
                    /* 접기: 높이를 0으로 */
                    subList.style.maxHeight = '0px';
                    menu.classList.remove('active-parent');
                    arrow.style.transform = 'rotate(0deg)';
                });
            }

            // 페이지 콘텐츠 로드 및 활성화 상태 설정
            function setActivePage(pageId) {
                deactivateAll();
                
                const activeItem = document.querySelector(`[data-page="${pageId}"]`);
                if (activeItem) {
                    activeItem.classList.add('active-link');
                    activeItem.classList.remove('transition-colors', 'duration-200');

                    const subList = activeItem.closest('.subList');
                    if (subList) {
                        const parentMenu = subList.closest('.parent-menu');
                        if (parentMenu) {
                            parentMenu.classList.add('active-parent');
                            subList.classList.add('visible');
                            subList.style.maxHeight = subList.scrollHeight + 'px';
                            parentMenu.querySelector('svg').style.transform = 'rotate(90deg)';
                        }
                    }
                }
                
                // 콘텐츠 렌더링
                const renderer = pageRenderers[pageId];
                if (renderer) {
                    const content = renderer();
                    if (pageId !== 'board') {
                        mainContent.innerHTML = content;
                    }
                    // 'board'는 loadBoardContent에서 직접 mainContent.innerHTML을 설정
                }
            }


            // 초기 상태: '메인' 항목 활성화
            const mainMenuItem = document.querySelector('[data-page="main"]');
            if (mainMenuItem) {
                setActivePage('main');
            }

            // 일반 메뉴 항목 클릭
            document.querySelectorAll('[data-page]:not(.parent-menu)').forEach(item => {
                item.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const pageId = item.getAttribute('data-page');
                    setActivePage(pageId);
                });
            });

            // 부모 메뉴 클릭/토글 (기존 로직 유지)
            parentMenus.forEach(parentMenu => {
                const subList = parentMenu.querySelector('.subList');
                const subMenuItems = subList.querySelectorAll('li');
                const arrow = parentMenu.querySelector('svg');

                parentMenu.addEventListener('click', (e) => {
                    // 서브 메뉴 클릭 시 부모 메뉴가 접히지 않도록 방지
                    if (e.target.closest('.subList')) return;
                    
                    const isParentActive = parentMenu.classList.contains('active-parent');

                    if (isParentActive) {
                        subList.classList.remove('visible');
                        /* 접기 높이 */
                        subList.style.maxHeight = '0px';
                        parentMenu.classList.remove('active-parent');
                        arrow.style.transform = 'rotate(0deg)';
                    } else {
                        deactivateAll();
                        subList.classList.add('visible');
                        parentMenu.classList.add('active-parent');
                        /* 펼칠 때 실제 내용 높이로 설정 (안 잘림) */
                        subList.style.maxHeight = subList.scrollHeight + 'px';
                        arrow.style.transform = 'rotate(90deg)';
                    }
                });

                // 서브 메뉴 항목 클릭
                subMenuItems.forEach(item => {
                    item.addEventListener('click', (event) => {
                        event.stopPropagation();
                        const pageId = item.getAttribute('data-page');
                        setActivePage(pageId);
                    });
                });
            });

            /* 창 크기 변경 시 열린 메뉴 높이 재계산 */
            window.addEventListener('resize', () => {
                document.querySelectorAll('.subList.visible').forEach(el => {
                    el.style.maxHeight = el.scrollHeight + 'px';
                });
            });
        });
    </script>

    <script>
        /* === 우측 상단 사용자 드롭다운 === */
        const myIconBtn = document.getElementById('myIconBtn');
        const userMenu = document.getElementById('userMenu');

        function closeUserMenu() {
            userMenu.classList.add('hidden');
            myIconBtn.setAttribute('aria-expanded', 'false');
        }

        myIconBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userMenu.classList.toggle('hidden');
            myIconBtn.setAttribute('aria-expanded',
                userMenu.classList.contains('hidden') ? 'false' : 'true');
        });

        userMenu.addEventListener('click', (e) => e.stopPropagation());
        document.addEventListener('click', closeUserMenu);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeUserMenu();
        });
    </script>
    
    <script src="07_board.js"></script>

</body>
</html>
