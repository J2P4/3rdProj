<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proj.spring.mes.dao.mapper.WorkerMapperDAO">
	<!-- SQL문 작성 영역 -->
	
	<!-- 전체 조회 -->
	<select id="selectWorker" resultType="workerDTO">
		select * from V3_worker
	</select>
	
	<!-- 
		resultType을 별칭을 쓸 수 있는 이유는 
		modelConfig.xml에서 typeAlias 별칭을 설정해놨기 때문이다. 
	-->
	
	<!-- 하나만 조회 -->
	<select id="selectOneWorker" resultType="workerDTO">
		select * from V3_worker
		where worker_id = #{_parameter}
	</select>

		
	<!-- 시퀀스 사용할 시 -->
<!-- 	<select id="getSeqEmp2" resultType="int"> -->
<!-- 		select seq_emp2.nextval from dual -->
<!-- 	</select> -->
	
	<!-- insert -->
	<!-- resultType이 정해져 있어 따로 안써도 됨 -->
	<!-- 시퀀스를 따지만 DTO에 넣어주진 않는다. -->
<!-- 	<insert id="insertEmp2" parameterType="empDTO"> -->
<!-- 		insert into emp2 (empno, ename, job, mgr, hiredate, sal, comm, deptno) -->
<!-- 		values (seq_emp2.nextval, #{ename} , #{job}, #{mgr}, #{hiredate}, #{sal}, #{comm}, #{deptno})	 -->
<!-- 	</insert> -->

	<!-- update -->
	<update id="updateWorker" parameterType="workerDTO">
		update V3_worker
		set	worker_name = #{worker_name},
			worker_birth = #{worker_birth},
			worker_pw = #{worker_pw},
			worker_email = #{worker_email},
			worker_code = #{worker_code}
		where worker_id = #{worker_id}
	</update>

	<!-- delete -->
	<!-- resultType이 정해져 있어 따로 안써도 됨 -->
	<delete id="deleteWorker" parameterType="workerDTO">
		delete from V3_worker
		where worker_id= #{worker_id}	
	</delete>
	
	<!-- insert -->
	<insert id="insertWorker" parameterType="workerDTO">
	  INSERT INTO V3_worker (worker_id, worker_name, worker_birth, worker_pw, worker_email, worker_code)
	  VALUES (
	    'A' || TO_CHAR(SYSDATE, 'YYMMDD') || TO_CHAR(WORKER_ID_SEQ.NEXTVAL, 'FM00'),
	    #{worker_name}, #{worker_birth}, #{worker_pw}, #{worker_email}, #{worker_code}
	  )
	
	  <!-- 같은 커넥션 내에서 CURRVAL로 방금 쓴 값을 안전하게 회수 -->
	  <selectKey keyProperty="worker_id" resultType="string" order="AFTER">
	    SELECT 'A' || TO_CHAR(SYSDATE, 'YYMMDD') || TO_CHAR(WORKER_ID_SEQ.CURRVAL, 'FM00')
	    FROM dual
	  </selectKey>
	</insert>

</mapper>




