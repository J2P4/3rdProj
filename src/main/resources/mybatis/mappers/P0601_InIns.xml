<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proj.spring.mes.dao.mapper.P0601_InInsMapperDAO">
	<!-- SQL문 작성 영역 -->
	
	<!-- 삽입 등에 worker_id 입력용으로 worker_name 조회하는 게 필요하려나... 알아보기 쉽게 -->
	
	<!-- 전체 조회 -->
	<select id = "selectInIns" resultType = "P0601_InInsDTO">
		select
			inspection_result_id, inspection_result_date, inspection_result_good,
			inspection_result_bad
		from v3_inspection_result
		where inspection_type = 0
		order by inspection_result_id
	</select>

	
	<!-- 단일 조회 -->
	<select id = "selectOneInIns" resultType = "P0601_InInsDTO">
		select
			i.inspection_result_id, i.inspection_result_date, i.inspection_result_good,
			i.inspection_result_bad, w.worker_name, i.stock_id
		from v3_inspection_result i
			left outer join v3_worker w
				on i.worker_id = w.worker_id
		where i.inspection_result_id = #{_parameter}
	</select>
	
	<!-- 수정 -->
	<update id = "updateInIns" parameterType = "P0601_InInsDTO">
		update v3_inspection_result
		set inspection_result_date = #{inspection_result_date},
			inspection_result_good = #{inspection_result_good},
			inspection_result_bad = #{inspection_result_bad},
			worker_id = #{worker_id},
			stock_id = #{stock_id}
		where inspection_result_id = #{inspection_result_id}
	</update>
	
	<!-- 삭제 -->
	<delete id = "deleteInIns" parameterType = "P0601_InInsDTO">
		delete from v3_inspection_result
		where inspection_result_id = #{inspection_result_id}
	</delete>
	
	<!-- 삽입 -->
	<insert id = "insertInIns" parameterType = "P0601_InInsDTO">
		<selectKey keyProperty="inspection_result_id" resultType="string" order="BEFORE">
		  select 'K' || TO_CHAR(SYSDATE, 'YYMMDD') || LPAD(worker_id_seq.NEXTVAL, 2, '0')
		  from dual
		</selectKey>
		
		insert into v3_inspection_result (
			inspection_result_id, inspection_result_date, inspection_result_good,
			inspection_result_bad, worker_id, stock_id
		)
		values (
			#{inspection_result_id}, #{inspection_result_date},
			#{inspection_result_good}, #{inspection_result_bad},
			#{worker_id}, #{stock_id}
		)
	</insert>
</mapper>