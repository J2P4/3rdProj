<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="proj.spring.mes.dao.mapper.ItemMapperDAO">

  <!-- 전체 목록 (무페이징) -->
  <select id="selectItemList" resultType="proj.spring.mes.dto.ItemDTO">
    <![CDATA[
    SELECT
      item_id,
      item_price,
      item_div,
      item_name,
      item_unit
    FROM V3_item
    ORDER BY item_name ASC
    ]]>
  </select>

  <!-- 페이징 목록 (Oracle ROWNUM 방식, limit/offset 그대로 받음) -->
  <!-- Mapper 인터페이스: selectItemListPage(@Param("limit") int limit, @Param("offset") int offset) -->
  <select id="selectItemListPage" resultType="proj.spring.mes.dto.ItemDTO">
    <bind name="startRow" value="offset + 1"/>
    <bind name="endRow"   value="offset + limit"/>
    <![CDATA[
    SELECT *
    FROM (
      SELECT t.*, ROWNUM rn
      FROM (
        SELECT
          item_id,
          item_price,
          item_div,
          item_name,
          item_unit
        FROM V3_item
        ORDER BY item_name ASC
      ) t
      WHERE ROWNUM <= #{endRow}
    )
    WHERE rn >= #{startRow}
    ]]>
  </select>

  <!-- 총 레코드 수 -->
  <select id="selectItemCount" resultType="long">
    <![CDATA[
    SELECT COUNT(*) FROM V3_item
    ]]>
  </select>

  <!-- 단건: 단일 문자열 파라미터는  -->
  <select id="selectItemOne" parameterType="string" resultType="proj.spring.mes.dto.ItemDTO">
    <![CDATA[
	SELECT
	  COALESCE(c.client_id, ci.client_id) AS client_id,  -- 조인 안 된 쪽도 아이디 보이게
	  c.client_name,
	  COALESCE(i.item_id, ci.item_id)     AS item_id,
	  i.item_name,
	  i.item_div,
	  i.item_price,
	  i.item_unit
	FROM v3_client c
	FULL OUTER JOIN v3_client_items ci
	  ON ci.client_id = c.client_id
	FULL OUTER JOIN v3_item i
	  ON i.item_id = ci.item_id 

    WHERE i.item_id = #{itemId}
    ]]>
  </select>
  
  <!-- 여러 개 ID 배치 삭제 -->
<delete id="deleteItems" parameterType="java.util.List">
  <![CDATA[
  DELETE FROM V3_item
  WHERE item_id IN
  ]]>
  <foreach item="id" collection="list" open="(" separator="," close=")">
    #{id}
  </foreach>
</delete>
  
  
  
  
  
  
  
  

  <!-- 등록 -->
  <insert id="insertItem" parameterType="proj.spring.mes.dto.ItemDTO">
    <![CDATA[
    INSERT INTO V3_item (
      item_id, item_price, item_div, item_name, item_unit
    ) VALUES (
      #{item_id}, #{item_price}, #{item_div}, #{item_name}, #{item_unit}
    )
    ]]>
  </insert>

  <!-- 수정 -->
  <update id="updateItem" parameterType="proj.spring.mes.dto.ItemDTO">
    <![CDATA[
    UPDATE V3_item
    SET
      item_price = #{item_price},
      item_div   = #{item_div},
      item_name  = #{item_name},
      item_unit  = #{item_unit}
    WHERE item_id = #{itemId}
    ]]>
  </update>

  <!-- 삭제: 단일 문자열 파라미터는 #{value} -->
  <delete id="deleteItem" parameterType="string">
    <![CDATA[
    DELETE FROM V3_item
    WHERE item_id = #{itemId}
    ]]>
  </delete>

</mapper>
