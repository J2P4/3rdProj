<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proj.spring.mes.dao.mapper.P0404_BomMapperDAO">
	<!-- SQL문 작성 영역 -->
	<!-- 지금 삭제 제외한 코드들은 전부 한 번씩 고민해봐야 함. 지금은 임의 복붙한 것. -->
	
	<!-- 전체 조회 : 이쪽은 ㅇㅋ -->
	<select id = "selectBOM" resultType = "P0404_BOMDTO">
		select
			b.bom_id, b.bom_amount, b.item_id, i.item_div
		from v3_bom b left outer join v3_item i
		on b.item_id = i.item_id
		order by b.bom_id
	</select>

	
	<!-- 단일 조회 - 정확히는 item_id 같은 것만 조회 -->
	<select id = "selectOneBOM" resultType = "P0404_BOMDTO">
		select
			b.bom_id, b.bom_amount, i.item_id, i.item_div
		from v3_bom b left outer join v3_item i
		on b.item_id = i.item_id
		<!-- where 영역 split 등 줘서 가져와야 함 -->
		where b.item_id = #{_parameter}
		order by b.bom_id	
	</select>
	
	<!-- 조회 : 품목 고르기용 1(재료) - 아직 품목 dto 없으므로 나중에 추가 -->
<!-- 	<select id = "selectOneBOM" resultType = "P0404_BOMDTO"> -->
	
<!-- 	</select> -->

	<!-- 조회 : 품목 고르기용 2(완제) - 아직 품목 dto 없으므로 나중에 추가 -->
<!-- 	<select id = "selectOneBOM" resultType = "P0404_BOMDTO"> -->
	
<!-- 	</select> -->
	
	<!-- 수정 : 여기도 재료 id를 이용해 작성하는 거니까 update에 bom id도 포함되어야 함-->
	<update id = "updateBOM" parameterType = "P0404_BOMDTO">
		update v3_bom
		set bom_amount = #{stock_amount},
			item_id = #{item_id}
		where bom_id = #{bom_id}
	</update>
	
	<!-- 삭제 : 이쪽은 ㅇㅋ -->
	<delete id = "deleteBOM" parameterType = "P0404_BOMDTO">
		delete from v3_bom
		where bom_id = #{bom_id}
	</delete>
	
	<!-- 삽입 : 여기를 to_char(sysdate)가 아니라 입력받은 재료 id값 일부가 들어가도록 조정해야 함-->
	<insert id = "insertBOM" parameterType = "P0404_BOMDTO">
		<selectKey keyProperty="BOM_id" resultType="string" order="BEFORE">
		  select 'F' || TO_CHAR(SYSDATE, 'YYMMDD') || LPAD(bom_id_seq.NEXTVAL, 2, '0')
		  from dual
		</selectKey>
		
		insert into v3_bom (
			bom_id, bom_amount, item_id
		)
		values (
			#{bom_id}, #{bom_amount}, #{item_id}
		)
	</insert>
</mapper>